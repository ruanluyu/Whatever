package system;

import processing.core.PVector;

public class Camera {
	public GameManager gm;
	public float easing = 0.1f;
	/**
	 * 摄像机的横坐标
	 */
	public float x;

	/**
	 * 摄像机的纵坐标
	 */
	public float y;

	/**
	 * 目标位置x
	 */
	public float tx;
	/**
	 * 目标位置y
	 */
	public float ty;

	/**
	 * target active area extension X 目标自由活动范围（相对于中心点）向x轴两侧扩展的像素数
	 */
	private Rectangle targetArea = null;

	/**
	 * 摄像机活动范围
	 */
	public Rectangle area = null;

	public Camera(Rectangle area) {
		this.area = area;
	}

	public Camera(GameManager m) {
		gm = m;
		float w = gm.parent.width;
		float h = gm.parent.height;
		float mw = gm.map.width * Map.BLOCKSIZE;
		float mh = gm.map.height * Map.BLOCKSIZE;
		area = new Rectangle(w / 2, h / 2, mw - w, mh - h);
		targetArea = new Rectangle(0, 0, w / 2, h / 2);
	}

	public void setTarget(int tx, int ty) {
		this.tx = tx;
		this.ty = ty;
	}

	public void setActiveArea(Rectangle r) {
		targetArea = r;
		targetArea.setCenterPointToCenter();
	}

	public void update() {
		targetArea.moveCenterTo(x, y);
		if (tx <= targetArea.p1x()) {
			x += easing * (tx - targetArea.p1x());
		} else if (tx >= targetArea.p2x()) {
			x += easing * (tx - targetArea.p2x());
		}
		if (ty <= targetArea.p1y()) {
			y += easing * (ty - targetArea.p1y());
		} else if (ty >= targetArea.p2y()) {
			y += easing * (ty - targetArea.p2y());
		}
		limitCheck();
	}

	private void limitCheck() {
		if (x < area.p1x()) {
			x = area.p1x();
		} else if (x > area.p2x()) {
			x = area.p2x();
		}
		if (y < area.p1y()) {
			y = area.p1y();
		} else if (y > area.p2y()) {
			y = area.p2y();
		}
	}

}
